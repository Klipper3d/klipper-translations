
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>Protocol - Klipper documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../_klipper3d/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-138371409-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#protocol" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Klipper documentation" class="md-header__button md-logo" aria-label="Klipper documentation" data-md-component="logo">
      
  <img src="../../img/klipper.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Klipper documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Protocol
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
      </form>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/zh/" hreflang="zh" class="md-select__link">
                    简体中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/zh-Hant/" hreflang="zh-Hant" class="md-select__link">
                    繁體中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/hu/" hreflang="hu" class="md-select__link">
                    Magyar
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/it/" hreflang="it" class="md-select__link">
                    Italiano
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Klipper3d/klipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Klipper3d/klipper
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Klipper documentation" class="md-nav__button md-logo" aria-label="Klipper documentation" data-md-component="logo">
      
  <img src="../../img/klipper.svg" alt="logo">

    </a>
    Klipper documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Klipper3d/klipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Klipper3d/klipper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Features.html" class="md-nav__link">
        Features
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ.html" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Releases.html" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Config_Changes.html" class="md-nav__link">
        Configuration Changes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Contact.html" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Installation and Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation and Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Installation and Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Installation.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          Configuration Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Configuration Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Config_Reference.html" class="md-nav__link">
        Configuration reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Rotation_Distance.html" class="md-nav__link">
        Rotation distance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Config_checks.html" class="md-nav__link">
        Configuration checks
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" type="checkbox" id="__nav_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_4">
          Bed Level
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bed Level" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Bed Level
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bed_Level.html" class="md-nav__link">
        Bed leveling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Delta_Calibrate.html" class="md-nav__link">
        Delta calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Probe_Calibrate.html" class="md-nav__link">
        Probe calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BLTouch.html" class="md-nav__link">
        BL-Touch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Manual_Level.html" class="md-nav__link">
        Manual leveling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bed_Mesh.html" class="md-nav__link">
        Bed Mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Endstop_Phase.html" class="md-nav__link">
        Endstop phase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Axis_Twist_Compensation.html" class="md-nav__link">
        Axis Twist Compensation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" type="checkbox" id="__nav_7_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_5">
          Resonance Compensation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resonance Compensation" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          Resonance Compensation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Resonance_Compensation.html" class="md-nav__link">
        Resonance Compensation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Measuring_Resonances.html" class="md-nav__link">
        Measuring Resonances
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Pressure_Advance.html" class="md-nav__link">
        Pressure advance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../G-Codes.html" class="md-nav__link">
        G-Codes
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_8" type="checkbox" id="__nav_7_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_8">
          Command templates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Command templates" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_8">
          <span class="md-nav__icon md-icon"></span>
          Command templates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Command_Templates.html" class="md-nav__link">
        Commands templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Status_Reference.html" class="md-nav__link">
        Status reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../TMC_Drivers.html" class="md-nav__link">
        TMC drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Multi_MCU_Homing.html" class="md-nav__link">
        Multiple Micro-controller Homing and Probing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Slicers.html" class="md-nav__link">
        Slicers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Skew_Correction.html" class="md-nav__link">
        Skew correction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Exclude_Object.html" class="md-nav__link">
        Exclude Objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Using_PWM_Tools.html" class="md-nav__link">
        Using PWM tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Developer Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Developer Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Code_Overview.html" class="md-nav__link">
        Code overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Kinematics.html" class="md-nav__link">
        Kinematics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Protocol.html" class="md-nav__link">
        Protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../API_Server.html" class="md-nav__link">
        API server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MCU_Commands.html" class="md-nav__link">
        MCU commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CANBUS_protocol.html" class="md-nav__link">
        CANBUS protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging.html" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Benchmarks.html" class="md-nav__link">
        Benchmarks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING.html" class="md-nav__link">
        Contributing to Klipper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Packaging.html" class="md-nav__link">
        Packaging Klipper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Device Specific Documents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Device Specific Documents" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Device Specific Documents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Example_Configs.html" class="md-nav__link">
        Example configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SDCard_Updates.html" class="md-nav__link">
        SDCard updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../RPi_microcontroller.html" class="md-nav__link">
        RPi microcontroller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Beaglebone.html" class="md-nav__link">
        Beaglebone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bootloaders.html" class="md-nav__link">
        Bootloaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bootloader_Entry.html" class="md-nav__link">
        Bootloader Entry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CANBUS.html" class="md-nav__link">
        CANBUS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CANBUS_Troubleshooting.html" class="md-nav__link">
        CANBUS Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../TSL1401CL_Filament_Width_Sensor.html" class="md-nav__link">
        TSL1401CL filament width sensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Hall_Filament_Width_Sensor.html" class="md-nav__link">
        Hall filament width sensor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Sponsors.html" class="md-nav__link">
        Sponsors
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interficie-de-microcontrolador" class="md-nav__link">
    Interfície de microcontrolador
  </a>
  
    <nav class="md-nav" aria-label="Interfície de microcontrolador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declaracio-dordres" class="md-nav__link">
    Declaració d'ordres
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaracio-de-respostes" class="md-nav__link">
    Declaració de respostes
  </a>
  
    <nav class="md-nav" aria-label="Declaració de respostes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#respostes-de-sortida" class="md-nav__link">
    Respostes de sortida
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaracio-denumeraments" class="md-nav__link">
    Declaració d'enumeraments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaracio-de-constants" class="md-nav__link">
    Declaració de constants
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codificacio-de-missatges-de-baix-nivell" class="md-nav__link">
    Codificació de missatges de baix nivell
  </a>
  
    <nav class="md-nav" aria-label="Codificació de missatges de baix nivell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocs-de-missatges" class="md-nav__link">
    Blocs de missatges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contingut-del-bloc-de-missatges" class="md-nav__link">
    Contingut del bloc de missatges
  </a>
  
    <nav class="md-nav" aria-label="Contingut del bloc de missatges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quantitats-de-longitud-variable" class="md-nav__link">
    Quantitats de longitud variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cordes-de-longitud-variable" class="md-nav__link">
    Cordes de longitud variable
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diccionari-de-dades" class="md-nav__link">
    Diccionari de dades
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flux-de-missatges" class="md-nav__link">
    Flux de missatges
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/Klipper3d/klipper/blob/master/docs/locales/ca/Protocol.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="protocol">Protocol<a class="headerlink" href="#protocol" title="Permanent link">&para;</a></h1>
<p>El protocol de missatgeria Klipper s'utilitza per a la comunicació de baix nivell entre el programari amfitrió Klipper i el programari del microcontrolador Klipper. A un alt nivell, el protocol es pot pensar com una sèrie de cadenes d'ordres i resposta que es comprimeixen, es transmeten i després es processen al costat receptor. Una sèrie d'exemple d'ordres en format llegible per humans sense comprimir podria semblar:</p>
<div class="highlight"><pre><span></span><code>set_digital_out pin=PA3 value=1
set_digital_out pin=PA7 value=1
schedule_digital_out oid=8 clock=4000000 value=0
queue_step oid=7 interval=7458 count=10 add=331
queue_step oid=7 interval=11717 count=4 add=1281
</code></pre></div>

<p>Consulteu el document <a href="MCU_Commands.html">mcu commands</a> per obtenir informació sobre les ordres disponibles. Consulteu el document <a href="Debugging.html">debugging</a> per obtenir informació sobre com traduir un fitxer G-Code a les seves ordres de microcontrolador llegibles per humans corresponents.</p>
<p>Aquesta pàgina proporciona una descripció d'alt nivell del propi protocol de missatgeria Klipper. Descriu com es declaren els missatges, es codifiquen en format binari (l'esquema de "compressió") i es transmeten.</p>
<p>L'objectiu del protocol és habilitar un canal de comunicació sense errors entre l'amfitrió i el microcontrolador que sigui de baixa latència, baix ample de banda i poca complexitat per al microcontrolador.</p>
<h2 id="interficie-de-microcontrolador">Interfície de microcontrolador<a class="headerlink" href="#interficie-de-microcontrolador" title="Permanent link">&para;</a></h2>
<p>El protocol de transmissió Klipper es pot pensar com un mecanisme <a href="https://ca.wikipedia.org/wiki/Remote_Procedure_Call">RPC</a> entre el microcontrolador i l'amfitrió. El programari del microcontrolador declara les ordres que l'amfitrió pot invocar juntament amb els missatges de resposta que pot generar. L'amfitrió utilitza aquesta informació per ordenar al microcontrolador que realitzi accions i que interpreti els resultats.</p>
<h3 id="declaracio-dordres">Declaració d'ordres<a class="headerlink" href="#declaracio-dordres" title="Permanent link">&para;</a></h3>
<p>El programari del microcontrolador declara una "ordre" mitjançant la macro DECL_COMMAND() al codi C. Per exemple:</p>
<div class="highlight"><pre><span></span><code>DECL_COMMAND(command_update_digital_out, &quot;update_digital_out oid=%c value=%c&quot;);
</code></pre></div>

<p>L'anterior declara una ordre anomenada "update_digital_out". Això permet que l'amfitrió "invoqui" aquesta ordre que provocaria que la funció C command_update_digital_out() s'executi al microcontrolador. L'anterior també indica que l'ordre pren dos paràmetres enters. Quan s'executa el codi command_update_digital_out() C, se li passarà una matriu que conté aquests dos nombres enters: el primer correspon a l''oid' i el segon al 'valor'.</p>
<p>En general, els paràmetres es descriuen amb la sintaxi d'estil printf() (per exemple, "%u"). El format correspon directament a la vista llegible per l'home de les ordres (per exemple, "update_digital_out oid=7 value=1"). A l'exemple anterior, "value=" és un nom de paràmetre i "%c" indica que el paràmetre és un nombre enter. Internament, el nom del paràmetre només s'utilitza com a documentació. En aquest exemple, el "%c" també s'utilitza com a documentació per indicar que l'enter esperat té una mida d'1 byte (la mida de l'enter declarada no afecta l'anàlisi o la codificació).</p>
<p>La construcció del microcontrolador recopilarà totes les ordres declarades amb DECL_COMMAND(), determinarà els seus paràmetres i disposarà que es puguin cridar.</p>
<h3 id="declaracio-de-respostes">Declaració de respostes<a class="headerlink" href="#declaracio-de-respostes" title="Permanent link">&para;</a></h3>
<p>Per enviar informació del microcontrolador a l'amfitrió es genera una "resposta". Tots dos es declaren i es transmeten mitjançant la macro C sendf(). Per exemple:</p>
<div class="highlight"><pre><span></span><code>sendf(&quot;status clock=%u status=%c&quot;, sched_read_time(), sched_is_shutdown());
</code></pre></div>

<p>L'anterior transmet un missatge de resposta "estat" que conté dos paràmetres sencers ("rellotge" i "estat"). La construcció del microcontrolador troba automàticament totes les trucades sendf() i genera codificadors per a elles. El primer paràmetre de la funció sendf() descriu la resposta i té el mateix format que les declaracions d'ordres.</p>
<p>L'amfitrió pot organitzar el registre d'una funció de devolució de trucada per a cada resposta. Així, en efecte, les ordres permeten a l'amfitrió invocar funcions C al microcontrolador i les respostes permeten que el programari del microcontrolador invoqui codi a l'amfitrió.</p>
<p>La macro sendf() només s'ha d'invocar des dels controladors d'ordres o tasques, i no s'ha d'invocar des d'interrupcions o temporitzadors. El codi no necessita emetre un sendf() en resposta a una ordre rebuda, no està limitat en el nombre de vegades que es pot invocar sendf() i pot invocar sendf() en qualsevol moment des d'un gestor de tasques.</p>
<h4 id="respostes-de-sortida">Respostes de sortida<a class="headerlink" href="#respostes-de-sortida" title="Permanent link">&para;</a></h4>
<p>Per simplificar la depuració, també hi ha una funció C output(). Per exemple:</p>
<div class="highlight"><pre><span></span><code>output(&quot;The value of %u is %s with size %u.&quot;, x, buf, buf_len);
</code></pre></div>

<p>La funció output() és similar en l'ús a printf(): té la intenció de generar i formatar missatges arbitraris per als humans.</p>
<h3 id="declaracio-denumeraments">Declaració d'enumeraments<a class="headerlink" href="#declaracio-denumeraments" title="Permanent link">&para;</a></h3>
<p>Les enumeracions permeten que el codi amfitrió utilitzi identificadors de cadena per als paràmetres que el microcontrolador gestiona com a nombres enters. Es declaren al codi del microcontrolador, per exemple:</p>
<div class="highlight"><pre><span></span><code>DECL_ENUMERATION(&quot;spi_bus&quot;, &quot;spi&quot;, 0);

DECL_ENUMERATION_RANGE(&quot;pin&quot;, &quot;PC0&quot;, 16, 8);
</code></pre></div>

<p>Si el primer exemple, la macro DECL_ENUMERATION() defineix una enumeració per a qualsevol missatge d'ordre/resposta amb un nom de paràmetre "spi_bus" o un nom de paràmetre amb un sufix de "_spi_bus". Per a aquests paràmetres, la cadena "spi" és un valor vàlid i es transmetrà amb un valor enter de zero.</p>
<p>També és possible declarar un rang d'enumeració. En el segon exemple, un paràmetre "pin" (o qualsevol paràmetre amb un sufix de "_pin") acceptaria PC0, PC1, PC2, ..., PC7 com a valors vàlids. Les cadenes es transmetran amb nombres enters 16, 17, 18, ..., 23.</p>
<h3 id="declaracio-de-constants">Declaració de constants<a class="headerlink" href="#declaracio-de-constants" title="Permanent link">&para;</a></h3>
<p>També es poden exportar constants. Per exemple, el següent:</p>
<div class="highlight"><pre><span></span><code>DECL_CONSTANT(&quot;SERIAL_BAUD&quot;, 250000);
</code></pre></div>

<p>exportaria una constant anomenada "SERIAL_BAUD" amb un valor de 250000 des del microcontrolador a l'amfitrió. També és possible declarar una constant que sigui una cadena, per exemple:</p>
<div class="highlight"><pre><span></span><code>DECL_CONSTANT_STR(&quot;MCU&quot;, &quot;pru&quot;);
</code></pre></div>

<h2 id="codificacio-de-missatges-de-baix-nivell">Codificació de missatges de baix nivell<a class="headerlink" href="#codificacio-de-missatges-de-baix-nivell" title="Permanent link">&para;</a></h2>
<p>Per aconseguir el mecanisme RPC anterior, cada comanda i resposta es codifica en un format binari per a la transmissió. En aquesta secció es descriu el sistema de transmissió.</p>
<h3 id="blocs-de-missatges">Blocs de missatges<a class="headerlink" href="#blocs-de-missatges" title="Permanent link">&para;</a></h3>
<p>Totes les dades enviades des de l'amfitrió al microcontrolador i viceversa estan contingudes en "blocs de missatges". Un bloc de missatges té una capçalera de dos bytes i un tràiler de tres bytes. El format d'un bloc de missatges és:</p>
<div class="highlight"><pre><span></span><code>&lt;1 byte length&gt;&lt;1 byte sequence&gt;&lt;n-byte content&gt;&lt;2 byte crc&gt;&lt;1 byte sync&gt;
</code></pre></div>

<p>El byte de longitud conté el nombre de bytes del bloc de missatges, inclosos els bytes de la capçalera i el tràiler (per tant, la longitud mínima del missatge és de 5 bytes). La longitud màxima del bloc de missatges és actualment de 64 bytes. El byte de seqüència conté un número de seqüència de 4 bits en els bits d'ordre inferior i els bits d'ordre superior sempre contenen 0x10 (els bits d'ordre superior es reserven per a un ús futur). Els bytes de contingut contenen dades arbitràries i el seu format es descriu a la secció següent. Els bytes crc contenen un CCITT [CRC] de 16 bits (<a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check">https://en.wikipedia.org/wiki/Cyclic_redundancy_check</a>) del bloc de missatges, inclosos els bytes de capçalera però exclosos els bytes del tràiler. El byte de sincronització és 0x7e.</p>
<p>El format del bloc de missatges està inspirat en marcs de missatges <a href="https://ca.wikipedia.org/wiki/HDLC">HDLC</a>. Igual que en HDLC, el bloc de missatges pot contenir opcionalment un caràcter de sincronització addicional a l'inici del bloc. A diferència de l'HDLC, un caràcter de sincronització no és exclusiu de l'enquadrament i pot estar present al contingut del bloc de missatges.</p>
<h3 id="contingut-del-bloc-de-missatges">Contingut del bloc de missatges<a class="headerlink" href="#contingut-del-bloc-de-missatges" title="Permanent link">&para;</a></h3>
<p>Cada bloc de missatges enviat des de l'amfitrió al microcontrolador conté una sèrie de zero o més ordres de missatge al seu contingut. Cada comanda comença amb una <a href="#variable-length-quantities">Quantitat de longitud variable</a> (VLQ) identificador d'ordre enter codificat seguit de zero o més paràmetres VLQ per a l'ordre donada.</p>
<p>Com a exemple, les quatre ordres següents es poden col·locar en un únic bloc de missatges:</p>
<div class="highlight"><pre><span></span><code>update_digital_out oid=6 value=1
update_digital_out oid=5 value=0
get_config
get_clock
</code></pre></div>

<p>i codificats en els vuit nombres enters VLQ següents:</p>
<div class="highlight"><pre><span></span><code>&lt;id_update_digital_out&gt;&lt;6&gt;&lt;1&gt;&lt;id_update_digital_out&gt;&lt;5&gt;&lt;0&gt;&lt;id_get_config&gt;&lt;id_get_clock&gt;
</code></pre></div>

<p>Per codificar i analitzar el contingut del missatge, tant l'amfitrió com el microcontrolador han d'acordar els identificadors de l'ordre i el nombre de paràmetres que té cada comanda. Així, a l'exemple anterior, tant l'amfitrió com el microcontrolador sabrien que "id_update_digital_out" sempre va seguit de dos paràmetres, i que "id_get_config" i "id_get_clock" tenen zero paràmetres. L'amfitrió i el microcontrolador comparteixen un "diccionari de dades" que mapeja les descripcions de les ordres (per exemple, "update_digital_out oid=%c value=%c") amb els seus identificadors d'ordres enters. En processar les dades, l'analitzador sabrà esperar un nombre específic de paràmetres codificats VLQ seguint un identificador d'ordre donat.</p>
<p>El contingut del missatge per als blocs enviats des del microcontrolador a l'amfitrió segueix el mateix format. Els identificadors d'aquests missatges són "identificadors de resposta", però tenen el mateix propòsit i segueixen les mateixes regles de codificació. A la pràctica, els blocs de missatges enviats des del microcontrolador a l'amfitrió mai contenen més d'una resposta al contingut del bloc de missatges.</p>
<h4 id="quantitats-de-longitud-variable">Quantitats de longitud variable<a class="headerlink" href="#quantitats-de-longitud-variable" title="Permanent link">&para;</a></h4>
<p>Consulteu l'<a href="https://en.wikipedia.org/wiki/Variable-length_quantity">article de la wikipedia</a> per obtenir més informació sobre el format general dels nombres enters codificats VLQ. Klipper utilitza un esquema de codificació que admet nombres enters positius i negatius. Els enters propers a zero utilitzen menys bytes per codificar i els enters positius normalment codifiquen amb menys bytes que els enters negatius. La taula següent mostra el nombre de bytes que cada nombre sencer necessita per codificar:</p>
<table>
<thead>
<tr>
<th>Enter</th>
<th>Mida codificada</th>
</tr>
</thead>
<tbody>
<tr>
<td>-32 .. 95</td>
<td>1</td>
</tr>
<tr>
<td>-4096 .. 12287</td>
<td>2</td>
</tr>
<tr>
<td>-524288 .. 1572863</td>
<td>3</td>
</tr>
<tr>
<td>-67108864 .. 201326591</td>
<td>4</td>
</tr>
<tr>
<td>-2147483648 .. 4294967295</td>
<td>5</td>
</tr>
</tbody>
</table>
<h4 id="cordes-de-longitud-variable">Cordes de longitud variable<a class="headerlink" href="#cordes-de-longitud-variable" title="Permanent link">&para;</a></h4>
<p>Com a excepció a les regles de codificació anteriors, si un paràmetre d'una ordre o resposta és una cadena dinàmica, aleshores el paràmetre no es codifica com un simple enter VLQ. En lloc d'això, es codifica mitjançant la transmissió de la longitud com un nombre enter codificat VLQ seguit del propi contingut:</p>
<div class="highlight"><pre><span></span><code>&lt;VLQ encoded length&gt;&lt;n-byte contents&gt;
</code></pre></div>

<p>Les descripcions d'ordres que es troben al diccionari de dades permeten tant a l'amfitrió com al microcontrolador saber quins paràmetres d'ordres utilitzen una codificació VLQ senzilla i quins paràmetres utilitzen la codificació de cadena.</p>
<h2 id="diccionari-de-dades">Diccionari de dades<a class="headerlink" href="#diccionari-de-dades" title="Permanent link">&para;</a></h2>
<p>Per tal que s'estableixin comunicacions significatives entre el microcontrolador i l'amfitrió, ambdues parts han d'acordar un "diccionari de dades". Aquest diccionari de dades conté els identificadors d'enters per a les ordres i les respostes juntament amb les seves descripcions.</p>
<p>La construcció del microcontrolador utilitza el contingut de les macros DECL_COMMAND() i sendf() per generar el diccionari de dades. La compilació assigna automàticament identificadors únics a cada comanda i resposta. Aquest sistema permet que tant l'amfitrió com el codi del microcontrolador utilitzin noms descriptius llegibles per l'home sense problemes, sense deixar de fer servir un ample de banda mínim.</p>
<p>L'amfitrió consulta el diccionari de dades quan es connecta per primera vegada al microcontrolador. Una vegada que l'amfitrió descarrega el diccionari de dades del microcontrolador, fa servir aquest diccionari de dades per codificar totes les ordres i analitzar totes les respostes del microcontrolador. Per tant, l'amfitrió ha de gestionar un diccionari de dades dinàmics. Tanmateix, per mantenir el programari del microcontrolador senzill, el microcontrolador sempre utilitza el seu diccionari de dades estàtics (compilats).</p>
<p>El diccionari de dades es consulta enviant ordres "identifica" al microcontrolador. El microcontrolador respondrà a cada ordre d'identificació amb un missatge "identificar_resposta". Com que aquestes dues ordres són necessàries abans d'obtenir el diccionari de dades, els seus identificadors enters i tipus de paràmetres estan codificats tant al microcontrolador com a l'amfitrió. L'identificador de resposta "identificar_resposta" és 0, l'identificador de l'ordre "identificar" és 1. A part de tenir identificadors codificats, l'ordre d'identificació i la seva resposta es declaren i es transmeten de la mateixa manera que altres ordres i respostes. No hi ha cap altra ordre o resposta codificada.</p>
<p>El format del propi diccionari de dades transmeses és una cadena JSON comprimida zlib. El procés de creació del microcontrolador genera la cadena, la comprimeix i l'emmagatzema a la secció de text del flash del microcontrolador. El diccionari de dades pot ser molt més gran que la mida màxima del bloc de missatges: l'amfitrió el descarrega enviant diverses ordres d'identificació demanant fragments progressius del diccionari de dades. Un cop obtinguts tots els fragments, l'amfitrió els reunirà, descomprimirà les dades i analitzarà el contingut.</p>
<p>A més de la informació sobre el protocol de comunicació, el diccionari de dades també conté la versió del programari, les enumeracions (definides per DECL_ENUMERATION) i constants (tal com les defineix DECL_CONSTANT).</p>
<h2 id="flux-de-missatges">Flux de missatges<a class="headerlink" href="#flux-de-missatges" title="Permanent link">&para;</a></h2>
<p>Les ordres de missatge enviades des de l'amfitrió al microcontrolador estan pensades per estar lliures d'errors. El microcontrolador comprovarà el CRC i els números de seqüència de cada bloc de missatges per assegurar-se que les ordres són precises i en ordre. El microcontrolador sempre processa els blocs de missatges en ordre: si rep un bloc fora d'ordre, el descartarà i qualsevol altre bloc fora d'ordre fins que rebi blocs amb la seqüenciació correcta.</p>
<p>El codi amfitrió de baix nivell implementa un sistema de retransmissió automàtica per als blocs de missatges perduts i corruptes enviats al microcontrolador. Per facilitar-ho, el microcontrolador transmet un "bloc de missatge de confirmació" després de cada bloc de missatge rebut amb èxit. L'amfitrió programa un temps d'espera després d'enviar cada bloc i es tornarà a transmetre si el temps d'espera expira sense rebre un "ack" corresponent. A més, si el microcontrolador detecta un bloc corrupte o fora d'ordre, pot transmetre un "bloc de missatge nu" per facilitar la retransmissió ràpida.</p>
<p>Un "ack" és un bloc de missatges amb contingut buit (és a dir, un bloc de missatges de 5 bytes) i un número de seqüència més gran que l'últim número de seqüència d'amfitrió rebut. Un "nak" és un bloc de missatges amb contingut buit i un número de seqüència menor que l'últim número de seqüència de l'amfitrió rebut.</p>
<p>El protocol facilita un sistema de transmissió "finestra" perquè l'amfitrió pugui tenir molts blocs de missatges destacats en vol alhora. (Això s'afegeix a les moltes ordres que poden estar presents en un bloc de missatges determinat.) Això permet una utilització màxima de l'ample de banda fins i tot en cas de latència de transmissió. El temps d'espera, la retransmissió, la finestra i el mecanisme de confirmació estan inspirats en mecanismes similars a <a href="https://ca.wikipedia.org/wiki/Transmission_Control_Protocoltocol">TCP</a>.</p>
<p>En l'altra direcció, els blocs de missatges enviats des del microcontrolador a l'amfitrió estan dissenyats per estar lliures d'errors, però no tenen una transmissió assegurada. (Les respostes no haurien de ser corruptes, però poden desaparèixer.) Això es fa per mantenir la implementació al microcontrolador senzilla. No hi ha un sistema de retransmissió automàtica per a les respostes: s'espera que el codi d'alt nivell sigui capaç de gestionar una resposta que falti ocasionalment (normalment tornant a sol·licitar el contingut o establir un programa recurrent de transmissió de respostes). El camp del número de seqüència dels blocs de missatges enviats a l'amfitrió sempre és un més gran que el darrer nombre de seqüències rebuts de blocs de missatges rebuts de l'amfitrió. No s'utilitza per fer un seguiment de seqüències de blocs de missatges de resposta.</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>